<form
  class="p-25"
  #form="ngForm"
  [formGroup]="participantForm"
  (ngSubmit)="saveParticipant()">
  <div fxLayout="row" fxLayoutGap="30px" class="buttons-wrapper">
    <button
      class="back-button"
      type="button"
      mat-button
      (click)="goToParticipantsList()">
      <mat-icon>arrow_back</mat-icon>
      <span>
        {{'ACTIONS.BACK' | translate}}
      </span>
    </button>

    <div fxLayout="row" *userPermission="['ADMIN']">
      <ng-container *ngIf="!editMode; else editModeBlock">
        <button
          class="orange-button"
          type="button"
          mat-button
          (click)="editParticipant()">
          <mat-icon>edit</mat-icon>
          <span>
            {{'ACTIONS.EDIT' | translate}}
          </span>
        </button>

        <button
          class="red-button"
          type="button"
          mat-button
          (click)="openDeleteParticipantDialog()">
          <mat-icon>delete</mat-icon>
          <span>
            {{'ACTIONS.DELETE' | translate}}
          </span>
        </button>
      </ng-container>

      <ng-template #editModeBlock>
        <button
          class="green-button"
          type="submit"
          mat-button>
          <mat-icon>done</mat-icon>
          <span>
            {{'ACTIONS.SAVE' | translate}}
          </span>
        </button>

        <button
          class="red-button"
          type="button"
          mat-button
          (click)="cancelEditing()">
          <mat-icon>close</mat-icon>
          <span>
            {{'ACTIONS.CANCEL' | translate}}
          </span>
        </button>
      </ng-template>
    </div>
  </div>

  <div class="mt-25">
    <ng-container *ngIf="editMode; else viewMode">
      <div class="editor-label m-0">Ім'я учасника (UA):</div>
      <mat-form-field floatLabel="never">
        <input matInput
               formControlName="fullName_UA"
               autocomplete="chrome-off"
               placeholder="Напишіть ім'я">
        <mat-error *ngIf="participantForm.controls['fullName_UA'].hasError('required') &&
                    participantForm.controls['fullName_UA'].touched || form.submitted">
          Це поле обов'язкове
        </mat-error>
      </mat-form-field>
      <div class="quill-editor-wrapper">
        <div class="editor-label">Текст (UA):</div>
        <quill-editor
          formControlName="bio_UA"
          [placeholder]="'Біо учасника фестивалю'"></quill-editor>
        <mat-hint class="mat-error" *ngIf="participantForm.controls['bio_UA'].hasError('required') &&
                    participantForm.controls['bio_UA'].touched || form.submitted">
          Це поле обов'язкове
        </mat-hint>
      </div>
      <div class="editor-label m-0">Participant's full name (EN):</div>
      <mat-form-field floatLabel="never">
        <input matInput
               formControlName="fullName_EN"
               autocomplete="chrome-off"
               placeholder="Type a name">
        <mat-error *ngIf="participantForm.controls['fullName_EN'].hasError('required') &&
                    participantForm.controls['fullName_EN'].touched || form.submitted">
          This field is required
        </mat-error>
      </mat-form-field>
      <div class="quill-editor-wrapper">
        <div class="editor-label">Text (EN):</div>
        <quill-editor
          formControlName="bio_EN"
          [placeholder]="'The participant\'s bio'"></quill-editor>
        <mat-hint class="mat-error" *ngIf="participantForm.controls['bio_EN'].hasError('required') &&
                    participantForm.controls['bio_UA'].touched || form.submitted">
          This field is required
        </mat-hint>
      </div>

      <ng-container *ngIf="imageUrl; else uploadField">
        <div class="editor-label">Image:</div>
        <div class="edit-image-container">
          <button
            class="clear-button"
            mat-mini-fab
            type="button"
            color="warn"
            matTooltip="Clear image"
            (click)="openClearImageDialog()"
            *ngIf="imageUrl">
            <mat-icon>clear</mat-icon>
          </button>
          <img [src]="imageUrl" alt="No image" *ngIf="imageUrl" width="500">
        </div>
      </ng-container>
      <ng-template #uploadField>
        <div class="editor-label">Upload image: </div>
        <app-drag-n-drop-upload
          [acceptMimetype]="'image/*'"
          [multiple]="false"
          (fileUploaded)="changeImage($event)"
        ></app-drag-n-drop-upload>
      </ng-template>
    </ng-container>
    <ng-template #viewMode>
      <ng-container *ngIf="participant">
        <img *ngIf="imageUrl" [src]="imageUrl" alt="No image" width="500">
        <h3>{{participant.fullName[lang]}}</h3>
        <div [innerHTML]="participant.bio[lang]"></div>
      </ng-container>
    </ng-template>
  </div>
</form>
